<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        .kuang{text-align: center;margin-top:200px;}
        #mess{text-align: center}
        .value{width: 200px;height:200px;border:1px solid;text-align: center;line-height: 200px;display: inline-block;}
    </style>
</head>
<body>
    <div id="mess">正在连接...</div>
    <div class="kuang">
        <div class="value" id="value1">AAAAAAAAAA连</div>
        <div class="value" id="value2">BBBBBBBBBBB</div>
        <div class="value" id="value3">CCCCCCCCCCC</div>
    </div>

    <script>
        var mess = document.getElementById("mess");
        var ws=null;
        if(window.WebSocket){
            /*function connect() { */
                           function connect(){
                                       try{
                                        ws = new WebSocket('ws://service520.com:3333/','bossreport');    
                                        ws.onopen = function(e){
                                              console.log("连接服务器成功");
                                              ws.send(JSON.stringify({"user":"client"}));
                                              heartCheck.start();
                                        }
                                        ws.onclose = function(e){
                                            connect();
                                        }
                                        ws.onerror = function(){
                                            console.log("连接出错");
                                        }

                                        ws.onmessage = function(e){
                            				
                                             heartCheck.reset();
                                             console.log(e.data);
                                             //mess.innerHTML = e.data;
                                           
                                        }
                                    }catch(ex){

                                    }
                        }
               
                        connect();
  


        }
                 var heartCheck = {
                            timeout: 60000,
                            timeoutObj: null,
                            reset: function(){
                                clearTimeout(this.timeoutObj);
                        　　　　 this.start();
                            },
                            start: function(){
                                this.timeoutObj = setTimeout(function(){
                                    ws.send("HeartBeat", "beat");
                                }, this.timeout)
                            }
                        }
                                              document.querySelector("#value1").onclick = function(e){
                                                var time = new Date();
                                            //  alert("OK");
                                               // ws.send(time + "  连接成功game1在" + e.target.innerHTML);
                                                //var cmd = '{"from":"client","to":"client","error":"","data":"xxxxx"}';
                                                var cmd=JSON.stringify({"from":"client","to":"client","action":"http://service520.com:3003/api/stores","mechod":"GET","data":"xxxxx"});
                                              try{
                                                ws.send(cmd); 
                                              }catch(ex){
                                                alert("connect is close")
                                              }
                                               

                                            }
                                             document.querySelector("#value2").onclick = function(e){
                                                var time = new Date();
                                                  // alert(2);
                                               // ws.send(time + "  连接成功game1在" + e.target.innerHTML);
                                                //var cmd = '{"from":"client","to":"client","error":"","data":"xxxxx"}';
                                                var cmd=JSON.stringify({"from":"client","to":"M01","action":"http://service520.com:3003/api/stores","mechod":"GET","data":"xxxxx"});
                            //                  var cmd=JSON.stringify({"from":"ALLCLIENTS","to":"M01","action":"xxx","mechod":"GET","data":"xxxxx"});
                            //                  var cmd=JSON.stringify({"from":"client","to":"ALLCLIEN","action":"xxx","mechod":"GET","data":"xxxxx"});
                                            try{
                                              //  setTimeout(function() {
                                                ws.send(cmd);     
                                            //}, 1000);
                                                
                                              }catch(ex){
                                                alert("connect is close")
                                              }

                                            }

                              document.querySelector("#value3").onclick = function(e){
                                                var time = new Date();
                                                  // alert(2);
                                               // ws.send(time + "  连接成功game1在" + e.target.innerHTML);
                                                //var cmd = '{"from":"client","to":"client","error":"","data":"xxxxx"}';
                                                var cmd=JSON.stringify({"from":"client","to":"M01","action":"http://service520.com:3003/api/items","mechod":"GET","data":"xxxxx"});
                            //                  var cmd=JSON.stringify({"from":"ALLCLIENTS","to":"M01","action":"xxx","mechod":"GET","data":"xxxxx"});
                            //                  var cmd=JSON.stringify({"from":"client","to":"ALLCLIEN","action":"xxx","mechod":"GET","data":"xxxxx"});
                                            try{
                                              //  setTimeout(function() {
                                                ws.send(cmd);     
                                            //}, 1000);
                                                
                                              }catch(ex){
                                                alert("connect is close")
                                              }

                                            }










    </script>




</body>
</html>